---
layout: default
order: 11
title:  "Genómica Parte 2"
date: 2020-06-10
time:   "mier-viernes 26-28 Ago"
categories: main
instructor: ""
materials: ""
material-type: ""
lesson-type: presencial, autoguiada, evaluada
---
<a href="https://pesalerno.github.io/genetica-ago-2020/main/2020/06/10/10_genomica-1.html"><button>Actividad Anterior</button></a>		<a href="https://pesalerno.github.io/genetica-ago-2020/"><button>Inicio</button></a>    <a href="https://pesalerno.github.io/genetica-ago-2020/main/2020/08/01/12_final.html"><button>Siguiente Actividad</button></a>

Taller #2: Genómica Poblacional y Markdown
=========



> -------------------
> 
> **VIERNES 9-10:30am** | Sesión Sincrónica de preguntas del Taller de genómica poblacional y Markdown
> 
> ------------------------


**RESUMEN DEL TALLER:** El taller de hoy está en dos partes, a pesar de ser dos partes de la misma entrega. En la primera parte, aprenderemos lo básico del código Markdown, para así poder generar un reporte formateado para nuestros resultados de la parte 2, donde haremos un análisis básico de estructura poblacional usando el paquete `adegenet` en `R`. Este taller debe ser entregado en parejas, y cada pareja debe escoger un set de datos: o pumas de Colorado, o insectos de río de... Colorado! (jaja, ahi hice mi postdoc y generé muchísimos datos genómicos).  Abajo les explico más de los dos proyectos. 


 
 
 Introducción a la bioinformática y al lenguaje Markdown
----
 

Inevitablemente, y a medida que los "datos grandes" ([Big Data](https://edu.t-bio.info/blog/2019/09/06/big-data-in-biology/)) se van volviendo mas comúnes, resulta indispensable que los ecólogos aprendan bioinformática básica, no sólo para ayudarles en sus carreras con herramientas útiles para el día a día, sino también para tener más opciones de contratación cuando se gradúen (nada atrae más a pontenciales futuros jefes que decir que uno puede escribir en varios lenguajes de computación). 

En este caso, estaremos aprendiendo del lenguaje [Markdown](https://www.markdownguide.org/getting-started/), un lenguaje super sencillo que se ha vuelto una herramienta indispensable y altamente utilizada para organizar código bioinformático, y así mismo, contribuír a la reproducibilidad de los resultados. 



> **NOTA DE CIENCIA ABIERTA:** A pesar de que la academia tiene varios controles de calidad inherentes al sistema de revisión y publicación científica, la ciencia nos ha demostrado que algunos estudios altamente controversiales terminan teniendo datos mal analizados o simplemente inventados. Tres ejemplos de estudios controversiales que fueron retractados debido a falta de reproducibilidad y claridad de datos y de metodos son el estudio que encontro que la preferencia de niñas recien nacidas obedece a instintos maternales, el estudio que encontro que las vacunas causaban autismo, y el estudio reciente que sugirio que la hydroxycloroquina era una cura efectiva para el coronavirus. Ahora, en la era del `big data` resulta mas importante que nunca tener un `pipeline` de metodos y resultados lo suficientemente detallado como para que cualquier persona pueda reproducir nuestros gráficos y llegar a nuestras mismas conclusiones. Pero, a menor escala, cualquier proyecto que tenga analisis de datos multifactoriales/multivariados, como lo son casi todos los proyectos de ingeniería, biología, ecología, y ciencias sociales, se beneficia de un protocolo abierto con un formato amigable para que el lector pueda reproducirlo y entender todos los detalles.  


Entonces, comencemos por bajarnos el programa que utilizaremos.  Aprender Markdown no es nada difícil. Basta con que instalen un buen editor de MarkDown, que para Mac/Linux sugiero [MacDown](https://macdown.uranusjr.com/) y para PC/Windows [Typora](https://typora.io/) ya que ayudan a aprender MarkDown en tiempo real, y luego ya pueden comienzar a trabajar en su codigo con base en cualquier archivo de Markdown.

>*Si no logran instalar o hacer funcionar alguno de estos editores Markdown, por favor avísenme para ayudarles.*


 --------------------------------------

 > [ACCEDA AL VIDEO EXPLICATIVO DE LA PRIMERA PARTE DEL TALLER  AQUI](https://www.loom.com/share/13b9c1be3f5d430fbc69bacf14d80e57) 

 ----------------------------------------

>En resumen y reiterando, lo que ustedes deben hacer para esta actividad es: **llevar a cabo el codigo de R de genetica poblacional y presentarlo en un documento Markdown que contenga la explicación básica de todo lo que se hizo**. Utilice el [siguiente documento como pase para construir su código de Markdown](https://github.com/pesalerno/genetica-ago-2020/blob/master/files/formato-entrega-taller-genomica.txt), lo cual pueden copiar/pegar directamente a Typora para comenzar a editar. Al hacer click en los vinculos de los archivos en github, deben hacer click en `Raw` o en `Download` para visualizar (y copiar/pegar) el codigo directo desde la web.  

___________________________________
 
 Luego, pueden continuar con [esta guia en línea](https://support.typora.io/Markdown-Reference/) de todos los comandos, o si quieren pueden editar alguno de mis proyectos/repositorios, como el de las [ranas Arlequin de Ecuador](https://github.com/pesalerno/Atelopus/blob/master/README.md). 

 --------------
 
 Genómica poblacional usando adegenet y R 
---------------



**DATOS A UTILIZAR PARA LOS ANÁLISIS:**   Para este taller, estaremos analizando (en parejas) y reportando acerca de dos estudios. 

**Efectos de una inundación en estructura poblacional de insectos de río.** El primer estudio está enfocado en estudiar los efectos de una inundación super grave, que ocurrió en Colorado en el 2013, en las poblaciones de insectos de río. Estos datos estan separados en pre/post inundación, por lo que los códigos de las poblaciones (6 en total) inidican no solo a cual poblacion pertenecen (al final del nombre) sino ademeas si las poblaciones son muestreadas pre/post inundación. La [matrix de datos de este proyeto la pueden encontrar aqui](https://github.com/pesalerno/genetica-ago-2020/blob/master/files/Msi_GP_in.gen), en formato `genepop` (`.gen`). 

**Efectos de aislamiento marino y movimiento humano en estructura poblacional de ranas de las islas Channel de California.** El segundo estudio está enfocado en estudiar la estructura poblacional de una especie de rana de amplia distribución en Norteamérica, para así examinar que tan independientes/aisladas están las poblaciones que se encuentran en distintas islas (3 en total) y en la tierra firme aledaña. Para cada isla, se tomaron muestras de dos poblaciones cada una para así también comparar con la estructura poblacional dentro de cada isla. LA [matriz de estos datos la pueden encontrar aqui](https://github.com/pesalerno/genetica-ago-2020/blob/master/files/Pr-03-22-6c.stru) en formato `structure` (`.stru`). 

 --------------
 
 > **PAGINA EN CONTRUCCION DE ACA EN ADELANTE. FAVOR REVISAR MAS TARDE.**
 
 --------------------------------------

> [ACCEDA AL VIDEO EXPLICATIVO DE LA SEGUNDA PARTE DEL TALLER  AQUI]() donde aprenderemos un poco de los formatos de los archivos con los que estamos trabajando, así como también un poco acerca de los datos y de cómo fueron generados. 

 ----------------------------------------




 Now, let's get started with our `R` code by opening R Studio and then starting a new R script (File>New File>R Script). <br>
 Before you get started, make sure you are in the workshop directory where you saved the `.stru` and the `.R` files: 

     setwd("~/Desktop/Genomics_USFQ_2019/workshop/epi")

 Then, we need to load the libraries that will be used: 

     library("adegenet")
     library("ggplot2")


 Now, we import our first SNP dataset, Colorado pumas, and name it ***myFile*** by writing:

     myFile <- import2genind("pumas-CO.stru") # must be saved as .stru - if you have an error, check its extension
     
 Then `R` will ask you to type the answers to these questions directly in the `R Console`:  

 - Question: How many genotypes are there? *(inds*) **Answer**:134 
 - Question: How many markers are there? *(SNPs)* **Answer**: 12456
 - Question: Which column contains the genotype label ('1' if absent)? **Answer**:1
 - Question: Which column contains the population factor ('0' if absent)? **Answer**:2
 - Question: Which other optional columns should be read (press 'return' when done)? **Press return**
 - Question: Which row contains the marker names ('0' if absent)? **Answer**:1
 - Question: Are genotypes coded by a single row (y/n)? **Answer**: n

 If all questions were answered correctly, then it should give you the following message: 

      Converting data from a STRUCTURE .stru file to a genind object... 
      
 Once imported, you can look at your transformed (summarized) *genind* file that the package `adegenet` uses, by typing: 

     myFile

 Now, we can run the code necessary for running a **Principal Components Analysis (PCA)**, but first we need to scale our missing data:

     X <- scaleGen(myFile, NA.method="zero")
     pca1<-dudi.pca(X,cent=FALSE,scale=FALSE,scannf=FALSE,nf=3)
     
 We define our plotting colors (so that pop1=darkgreen and pop2=darkblue), and then we generate our PCA scatterplot and our PC eigenvalues:

     myCol <-c("darkgreen","darkblue")
     s.class(pca1$li,pop(myFile), col=myCol)
     add.scatter.eig(pca1$eig[1:20], 3,1,2)
     
 Now we are interested in finding potential migrant pumas between our populations, so we want to see where individual labels fall within the PCA plot:
     
     s.label(pca1$li)
     
 Hm, that's not very informative. Let's try running a **Discriminant Analysis of Principal Components (DAPC)**, which tries to maximize the difference among pre-defined groups based on the Principal Components. 

     dapc1<-dapc(X,pop(myFile))
 The `R Console` will now ask you a couple of questions based on the graphs. First, it will ask how many principal components you want to keep, we will keep ten for our analysis (so, type `10` into the `R Console`). then, it will ask you how many discriminant functions you want to keep, in this case we only hae two groups thus only one DF, so type `1` into the `R Console`, and then we can see the summary and plot of our DAPC:

     summary(dapc1)
     scatter(dapc1)

     
 Finally, we can visualize the DAPC as a **compoplot**, which is analogous to **STRUCTURE** analyses, where each bar is an individual an the colors are its probability of belonging to a specific group, or similarly, probability of admixture. 

     compoplot(dapc1,posi="bottomright",lab="", ncol=1,xlab="individuals") 
     
 Now we can clearly identify and visualize both migrant individuals and admixed individuals as well. But, it's still impossible to know which individual ID belongs to migrants and to admixed, so we now type:
     
     assignplot(dapc1, subset=1:40)        
     assignplot(dapc1, subset=41:80)
     assignplot(dapc1, subset=81:100)
     assignplot(dapc1, subset=101:134)

 Now we can clearly identify each migrant individual by name!  

 Finally, we can run all the same analyses by tweaking the code just a little bit with this other [dataset](https://github.com/rdtarvin/IBS2019_Genomics-of-Biodiversity/blob/master/files/Msi_GP_in.gen)... can you figure out the PCA colors and how many Principal Components and Discriminant Functions to keep? 


 
<a href="https://pesalerno.github.io/genetica-ago-2020/main/2020/06/10/10_genomica-1.html"><button>Actividad Anterior</button></a>		<a href="https://pesalerno.github.io/genetica-ago-2020/"><button>Inicio</button></a>    <a href="https://pesalerno.github.io/genetica-ago-2020/main/2020/08/01/12_final.html"><button>Siguiente Actividad</button></a>
